# Supabase Integration - Summary

## –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```bash
npm install @supabase/supabase-js
```

### 2. –°–æ–∑–¥–∞–Ω SupabaseDatabase adapter
**–§–∞–π–ª:** `src/models/SupabaseDatabase.js`

- –ü–æ–ª–Ω–∞—è –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è –≤—Å–µ—Ö –º–µ—Ç–æ–¥–æ–≤ —Ä–∞–±–æ—Ç—ã —Å –ë–î
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `@supabase/supabase-js` –≤–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ PostgreSQL
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π: users, subscriptions, payments, usage_logs, notifications
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã —Å Promise
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- –ú–µ—Ç–æ–¥—ã —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
**–§–∞–π–ª—ã:**
- `.env` - –¥–æ–±–∞–≤–ª–µ–Ω—ã `SUPABASE_URL` –∏ `SUPABASE_API_KEY`
- `.env.example` - –æ–±–Ω–æ–≤–ª—ë–Ω —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ Supabase –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- `src/config/database.js` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Å–µ–∫—Ü–∏—è `supabase`
- `src/bot/VPNBot.js` - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ 3 —Ç–∏–ø–æ–≤ –ë–î (sqlite/postgres/supabase)

### 4. –°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç
**–§–∞–π–ª:** `test-supabase.js`

–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Supabase
- –ù–∞–ª–∏—á–∏–µ —Ç–∞–±–ª–∏—Ü
- –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- –í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

### 5. –û–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
**–§–∞–π–ª:** `SUPABASE_SETUP.md`

–í–∫–ª—é—á–∞–µ—Ç:
- –ü–æ—à–∞–≥–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å API –∫–ª—é—á–∏
- –ö–∞–∫ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
- Troubleshooting
- Row Level Security –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
- –ü–æ–ª–µ–∑–Ω—ã–µ SQL –∑–∞–ø—Ä–æ—Å—ã

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –®–∞–≥ 1: –í—ã–ø–æ–ª–Ω–∏—Ç—å SQL –º–∏–≥—Ä–∞—Ü–∏—é

1. –û—Ç–∫—Ä–æ–π—Ç–µ https://supabase.com/dashboard
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç
3. SQL Editor ‚Üí New query
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ **–í–°–Å** –∏–∑ `migrations/001_initial_schema.sql`
5. –í—Å—Ç–∞–≤—å—Ç–µ –∏ –Ω–∞–∂–º–∏—Ç–µ Run

### –®–∞–≥ 2: –û—Ç–∫–ª—é—á–∏—Ç—å RLS (Row Level Security)

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ SQL Editor:

```sql
ALTER TABLE users DISABLE ROW LEVEL SECURITY;
ALTER TABLE subscriptions DISABLE ROW LEVEL SECURITY;
ALTER TABLE payments DISABLE ROW LEVEL SECURITY;
ALTER TABLE usage_logs DISABLE ROW LEVEL SECURITY;
ALTER TABLE notifications DISABLE ROW LEVEL SECURITY;
```

–≠—Ç–æ –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã –±–æ—Ç –º–æ–≥ —Ä–∞–±–æ—Ç–∞—Ç—å —á–µ—Ä–µ–∑ `anon` API –∫–ª—é—á.

### –®–∞–≥ 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –õ–æ–∫–∞–ª—å–Ω–æ
node test-supabase.js

# –ï—Å–ª–∏ –≤—Å—ë –û–ö, –∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞
npm start
```

### –®–∞–≥ 4: –î–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
cd ~/letmeoutbot
nano .env

# –î–æ–±–∞–≤—å—Ç–µ:
DATABASE_TYPE=supabase
SUPABASE_URL=https://zvipxeojiiyhfelsekjt.supabase.co
SUPABASE_API_KEY=your_key_here

# –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker-compose down
docker-compose build
docker-compose up -d

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
docker logs vpnbot-prod -f
```

## –¢–∏–ø—ã –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö

–¢–µ–ø–µ—Ä—å –±–æ—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç 3 —Ç–∏–ø–∞ –ë–î:

### SQLite (–ª–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞)
```env
DATABASE_TYPE=sqlite
DATABASE_PATH=./database.db
```
‚úÖ –ë—ã—Å—Ç—Ä–æ –¥–ª—è —Ç–µ—Å—Ç–æ–≤
‚ùå –ù–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω–∞

### Supabase (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω–∞)
```env
DATABASE_TYPE=supabase
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_API_KEY=your_anon_key
```
‚úÖ –ü—Ä–æ—Å—Ç–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
‚úÖ –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã (–ø–ª–∞—Ç–Ω—ã–π –ø–ª–∞–Ω)
‚úÖ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Ç–∞—Ä–∏—Ñ: 500MB –ë–î

### PostgreSQL Direct (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞)
```env
DATABASE_TYPE=postgres
DATABASE_URL=postgresql://user:pass@host:port/db
```
‚úÖ –ü—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
‚ùå –°–ª–æ–∂–Ω–µ–µ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å
‚ùå –ù—É–∂–µ–Ω SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ Supabase

1. **–ü—Ä–æ—Å—Ç–æ—Ç–∞** - —Ç–æ–ª—å–∫–æ URL –∏ API –∫–ª—é—á
2. **Web UI** - —É–¥–æ–±–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–∞–Ω–Ω—ã—Ö
3. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π SSL, API –∫–ª—é—á–∏
4. **–ë–µ—Å–ø–ª–∞—Ç–Ω–æ** - –¥–æ 500MB –∏ 2GB —Ç—Ä–∞—Ñ–∏–∫–∞ –≤ –º–µ—Å—è—Ü
5. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –ª–µ–≥–∫–æ –∞–ø–≥—Ä–µ–π–¥–∏—Ç—å –Ω–∞ –ø–ª–∞—Ç–Ω—ã–π –ø–ª–∞–Ω
6. **Real-time** - –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ –±—É–¥—É—â–µ–º
7. **REST API** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π API –¥–ª—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü

## –§–∞–π–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –∏–∑–º–µ–Ω–µ–Ω—ã

```
‚úÖ package.json - –¥–æ–±–∞–≤–ª–µ–Ω @supabase/supabase-js
‚úÖ .env - –¥–æ–±–∞–≤–ª–µ–Ω—ã SUPABASE_URL –∏ SUPABASE_API_KEY
‚úÖ .env.example - –æ–±–Ω–æ–≤–ª—ë–Ω –ø—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚úÖ src/config/database.js - –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Å–µ–∫—Ü–∏—è supabase
‚úÖ src/bot/VPNBot.js - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ 3 —Ç–∏–ø–æ–≤ –ë–î
‚ûï src/models/SupabaseDatabase.js - –Ω–æ–≤—ã–π –∞–¥–∞–ø—Ç–µ—Ä
‚ûï test-supabase.js - —Å–∫—Ä–∏–ø—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
‚ûï SUPABASE_SETUP.md - –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
‚ûï SUPABASE_MIGRATION_SUMMARY.md - —ç—Ç–æ—Ç —Ñ–∞–π–ª
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏ SQL –∑–∞–ø—É—Å—Ç–∏—Ç–µ:

```bash
node test-supabase.js
```

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
```
‚úÖ Supabase –∫–ª–∏–µ–Ω—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Supabase —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
‚úÖ –ù–∞–π–¥–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: 0
‚úÖ –ê–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–æ–∫: 0
‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ!
üöÄ Supabase –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
```

## Troubleshooting

### –û—à–∏–±–∫–∞: "Could not find the table"
‚Üí –í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –º–∏–≥—Ä–∞—Ü–∏—é –∏–∑ `migrations/001_initial_schema.sql`

### –û—à–∏–±–∫–∞: "Invalid API key"
‚Üí –ü—Ä–æ–≤–µ—Ä—å—Ç–µ SUPABASE_API_KEY –≤ .env (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å anon public key)

### –û—à–∏–±–∫–∞: "new row violates row-level security policy"
‚Üí –û—Ç–∫–ª—é—á–∏—Ç–µ RLS: `ALTER TABLE users DISABLE ROW LEVEL SECURITY;`

### –ë–æ—Ç –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
‚Üí –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker logs vpnbot-prod --tail 50`
